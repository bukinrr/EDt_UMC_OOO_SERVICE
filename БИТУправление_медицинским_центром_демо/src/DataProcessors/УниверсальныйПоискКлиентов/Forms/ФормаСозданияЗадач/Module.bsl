#Область ОбработчикиСобытийФормы
&НаСервере
Процедура ПриСозданииНаСервере(Отказ, СтандартнаяОбработка)
	
	СрокИсполнения = ТекущаяДата() + 86400;
	Исполнитель = ПараметрыСеанса.ТекущийПользователь;
	СписокКлиентов = Параметры.СписокКлиентов;
	СписокКлиентов.ЗаполнитьПометки(Истина);
	
КонецПроцедуры

#КонецОбласти

#Область ОбработчикиСобытийЭлементовШапкиФормы
&НаКлиенте
Процедура ОповещениеПриИзменении(Элемент)
	
	ИзменениеОповещения=0;
	
КонецПроцедуры

#КонецОбласти

#Область ОбработчикиКомандФормы
&НаКлиенте
Процедура СоздатьЗадачиПользователя(Команда)
	
	СозданоОбъектов = СоздатьЗадачиПользователяНаСервере();
	Предупреждение("Создано задач: " + Строка(СозданоОбъектов), 10, "Оповещение");
	Закрыть();
	
КонецПроцедуры

&НаСервере
Функция СоздатьЗадачиПользователяНаСервере()
	
	СчСозданных = 0;
	Для Каждого элКлиент Из СписокКлиентов Цикл 
		
		Если Не элКлиент.Пометка Тогда 
			Продолжить;
		КонецЕсли;
		
		ЗадачаОбъект = Задачи.ЗадачиПользователя.СоздатьЗадачу();
		ЗаполнитьЗначенияСвойств(ЗадачаОбъект, ЭтаФорма);
		ЗадачаОбъект.Дата = ТекущаяДата();
		ЗадачаОбъект.Объект = элКлиент.Значение;
		ЗадачаОбъект.КонтактноеЛицо = элКлиент.Значение;
		ЗадачаОбъект.Инициатор = ПараметрыСеанса.ТекущийПользователь;
		ЗадачаОбъект.Записать();
		
		СчСозданных = СчСозданных + 1;
		
	КонецЦикла;
	
	Возврат СчСозданных;
	
КонецФункции


#КонецОбласти
