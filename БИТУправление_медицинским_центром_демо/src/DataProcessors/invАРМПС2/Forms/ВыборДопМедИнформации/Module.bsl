#Область ОбработчикиСобытийФормы

&НаСервере
Процедура ПриСозданииНаСервере(Отказ, СтандартнаяОбработка)
	ТЗ_ДМИ = Новый ТаблицаЗначений;
	ТЗ_ДМИ.Колонки.Добавить("AuxiliaryInfoId");
	Для каждого элтДМИ Из Параметры.IDДМИ Цикл
		стрТЗ_ДМИ = ТЗ_ДМИ.Добавить();
		стрТЗ_ДМИ.AuxiliaryInfoId = элтДМИ.AuxiliaryInfoId;
	КонецЦикла;
	ТЗ_ДМИ.Свернуть("AuxiliaryInfoId");
	
	ДобавляемыеРеквизиты = Новый Массив;
	МассивТипов = Новый Массив;
	МассивТипов.Добавить(Тип("Строка"));
	Для каждого стр Из ТЗ_ДМИ Цикл
		УИ = Новый УникальныйИдентификатор(стр.AuxiliaryInfoId);
		Ссылка = ПланыВидовХарактеристик.invЛабораторныеПараметры.ПолучитьСсылку(УИ);
		Если ЗначениеЗаполнено(Ссылка.Код) Тогда
			ЗаголовокРФ = СтрЗаменить(СтрЗаменить(СтрЗаменить(СтрЗаменить(СтрЗаменить(Ссылка.Наименование," ",""),"/",""),"-",""),".",""),"+","");
			Реквизит = Новый РеквизитФормы(ЗаголовокРФ,Новый ОписаниеТипов(МассивТипов),,Строка(Ссылка.Наименование), Истина);
			ДобавляемыеРеквизиты.Добавить(Реквизит);
		КонецЕсли;
	КонецЦикла;
	ИзменитьРеквизиты(ДобавляемыеРеквизиты);
	
	
	Для каждого стр Из ТЗ_ДМИ Цикл
		УИ = Новый УникальныйИдентификатор(стр.AuxiliaryInfoId);
		Ссылка = ПланыВидовХарактеристик.invЛабораторныеПараметры.ПолучитьСсылку(УИ);
		Если ЗначениеЗаполнено(Ссылка.Код) Тогда
			ЗаголовокРФ = СтрЗаменить(СтрЗаменить(СтрЗаменить(СтрЗаменить(СтрЗаменить(Ссылка.Наименование," ",""),"/",""),"-",""),".",""),"+","");
			ЭлементФормы = ЭтаФорма.Элементы.Добавить(ЗаголовокРФ, Тип("ПолеФормы"), ЭтаФорма);
			ЭлементФормы.ПутьКДанным = ЗаголовокРФ; 
			ЭлементФормы.Вид         = ВидПоляФормы.ПолеВвода;
			Если Ссылка.Варианты.Количество() > 0 Тогда
				ЭлементФормы.РежимВыбораИзСписка = Истина;
				Для Каждого Вариант Из Ссылка.Варианты Цикл
					ЭлементФормы.СписокВыбора.Добавить(Вариант.Значение);
				КонецЦикла;
			КонецЕсли;
			Если Ссылка.Обязательное Тогда
				ЭлементФормы.Подсказка = "Обязательное заполнение";
				//ЭлементФормы.ШрифтЗаголовка = ШрифтыСтиля.ШрифтТекста;
				ЭлементФормы.ШрифтЗаголовка = Новый Шрифт(,,Истина);
			КонецЕсли;
		КонецЕсли;
	КонецЦикла;	
КонецПроцедуры

#КонецОбласти

#Область СлужебныеПроцедурыИФункции

&НаСервере
Процедура ПродолжитьНаСервере()
	Структура = Новый Соответствие;
	Для Каждого стр Из Параметры.IDДМИ Цикл
		УИ = Новый УникальныйИдентификатор(стр.AuxiliaryInfoId);
		Ссылка = ПланыВидовХарактеристик.invЛабораторныеПараметры.ПолучитьСсылку(УИ);
		Если ЗначениеЗаполнено(Ссылка.Код) Тогда
			ЗаголовокРФ = СтрЗаменить(СтрЗаменить(СтрЗаменить(СтрЗаменить(СтрЗаменить(Ссылка.Наименование," ",""),"/",""),"-",""),".",""),"+","");
			Если Ссылка.Обязательное И НЕ ЗначениеЗаполнено(ЭтаФорма[ЗаголовокРФ]) Тогда
				ОбщегоНазначенияКлиентСервер.СообщитьПользователю("Не заполнена обязательная медицинская информация - " + Ссылка.Наименование + " !");
				Возврат
			КонецЕсли;
			 value = ЭтаФорма[ЗаголовокРФ];
			 Структура.Вставить(стр.AuxiliaryInfoId,value);
		КонецЕсли;
	КонецЦикла;
	Параметры.АдресХранилища = ПоместитьВоВременноеХранилище(Структура);
КонецПроцедуры

#КонецОбласти

#Область ОбработчикиКомандФормы

&НаКлиенте
Процедура ПродолжитьОформление(Команда)
	ПродолжитьНаСервере();
	Если ЗначениеЗаполнено(Параметры.АдресХранилища) Тогда
		Закрыть(Параметры.АдресХранилища);
	КонецЕсли;
КонецПроцедуры

#КонецОбласти
