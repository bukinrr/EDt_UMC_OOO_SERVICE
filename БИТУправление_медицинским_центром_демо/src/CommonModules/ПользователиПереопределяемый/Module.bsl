#Область ПрограммныйИнтерфейс

// Позволяет указать роли, назначение которых будет контролироваться особым образом.
// Большинство ролей конфигурации не требуется здесь указывать, т.к. они предназначены для любых пользователей, 
// кроме внешних пользователей.
//
// Параметры:
//  НазначениеРолей - Структура - со свойствами:
//   * ТолькоДляАдминистраторовСистемы - Массив - имена ролей, которые при выключенном разделении
//     предназначены для любых пользователей, кроме внешних пользователей, а в разделенном режиме
//     предназначены только для администраторов сервиса, например:
//       Администрирование, ОбновлениеКонфигурацииБазыДанных, АдминистраторСистемы,
//     а также все роли с правами:
//       Администрирование,
//       Администрирование расширений конфигурации,
//       Обновление конфигурации базы данных.
//     Такие роли, как правило, существуют только в БСП и не встречаются в прикладных решениях.
//
//   * ТолькоДляПользователейСистемы - Массив - имена ролей, которые при выключенном разделении
//     предназначены для любых пользователей, кроме внешних пользователей, а в разделенном режиме
//     предназначены только для неразделенных пользователей (сотрудников технической поддержки сервиса и
//     администраторов сервиса), например:
//       ДобавлениеИзменениеАдресныхСведений, ДобавлениеИзменениеБанков,
//     а также все роли с правами изменения неразделенных данных и следующими правами:
//       Толстый клиент,
//       Внешнее соединение,
//       Automation,
//       Режим все функции,
//       Интерактивное открытие внешних обработок,
//       Интерактивное открытие внешних отчетов.
//     Такие роли в большей части существует в БСП, но могут встречаться и в прикладных решениях.
//
//   * ТолькоДляВнешнихПользователей - Массив - имена ролей, которые предназначены
//     только для внешних пользователей (роли со специально разработанным набором прав), например:
//       ДобавлениеИзменениеОтветовНаВопросыАнкет, БазовыеПраваВнешнихПользователейБСП.
//     Такие роли существуют и в БСП, и в прикладных решениях (если используются внешние пользователи).
//
//   * СовместноДляПользователейИВнешнихПользователей - Массив - имена ролей, которые предназначены
//     для любых пользователей (и внутренних, и внешних, и неразделенных), например:
//       ЧтениеОтветовНаВопросыАнкет, ДобавлениеИзменениеЛичныхВариантовОтчетов.
//     Такие роли существуют и в БСП, и в прикладных решениях (если используются внешние пользователи).
//
Процедура ПриОпределенииНазначенияРолей(НазначениеРолей) Экспорт
	
	Возврат;
	
КонецПроцедуры

// Функция ЗапретРедактированияРолей используется для
// управления поведением подсистем Пользователи и ВнешниеПользователи,
// когда требуется переключится в режим автоустановки ролей пользователей ИБ,
// например, при встраивании подсистемы УправлениеДоступом.
//
// Возвращаемое значение:
//  Булево.
//
Функция ЗапретРедактированияРолей() Экспорт
	
	Возврат Истина;
	
КонецФункции

// Процедура ИзменитьДействияВФорме позволяет переопределить
// поведение форм пользователя, внешнего пользователя, группы внешних пользователей
// когда это требуется, например, при встараивании подсистемы "Управление доступом".
//
// Параметры:
//  Ссылка - СправочникСсылка.Пользователи,
//           СправочникСсылка.ВнешниеПользователи,
//           СправочникСсылка.ГруппыВнешнихПользователей
//           ссылка на пользователя, внешнего пользователя или группу внешних пользователей
//           при создании формы.
//
//  ДействияВФорме - Структура (со свойствами типа Строка):
//           Роли                   = "", "Просмотр",     "Редактирование"
//           КонтактнаяИнформация   = "", "Просмотр",     "Редактирование"
//           СвойстваПользователяИБ = "", "ПросмотрВсех", "РедактированиеВсех", РедактированиеСвоих"
//           СвойстваЭлемента       = "", "Просмотр",     "Редактирование"
//           
//           Для групп внешних пользователей КонтактнаяИнформация и СвойстваПользователяИБ не существуют.
//
Процедура ИзменитьДействияВФорме(Знач Ссылка = Неопределено, Знач ДействияВФорме) Экспорт
	
	// УправлениеДоступом
	ДействияВФорме.Роли = "";
	// Конец УправлениеДоступом
	
КонецПроцедуры

// Обработчик события ПриЗаписи пользователя информационной базы
// вызывается из процедуры ЗаписатьПользователяИБ(), если пользователь
// был действительно записан.
//
// Параметры:
//  СтарыеСвойства - Структура, см. параметры возвращаемые функцией Пользователи.ПрочитатьПользователяИБ()
//  НовыеСвойства  - Структура, см. параметры возвращаемые функцией Пользователи.ЗаписатьПользователяИБ()
//
Процедура ПриЗаписиПользователяИнформационнойБазы(Знач СтарыеСвойства, Знач НовыеСвойства) Экспорт
	
	// ФайловыеФункции
	Если ЗначениеЗаполнено(СтарыеСвойства.ПользовательИнфБазыИмя) И
	     ВРег(СтарыеСвойства.ПользовательИнфБазыИмя) <> ВРег(НовыеСвойства.ПользовательИнфБазыИмя) Тогда
		
	КонецЕсли;
	// Конец ФайловыеФункции
	
КонецПроцедуры

// Обработчик события ПослеУдаления пользователя информационной базы
// вызывается из процедуры УдалитьПользователяИБ(), если пользователь
// был действительно удален.
//
// Параметры:
//  СтарыеСвойства - Структура, см. параметры возвращаемые функцией Пользователи.ПрочитатьПользователяИБ()
//
Процедура ПослеУдаленияПользователяИнформационнойБазы(Знач СтарыеСвойства) Экспорт
	
	
	
КонецПроцедуры

// Возвращает роль предоставляющую права администрироваия системы.
//
// Возвращаемое значение:
//  Метаданные.Роль 
Функция РольАдминистратораСистемы() Экспорт
	
	Возврат Метаданные.Роли.ПолныеПрава;
	
КонецФункции

////////////////////////////////////////////////////////////////////////////////
// Обработчики записи первого администратора

// Обработчик события ТекстВопросаПередЗаписьюПервогоАдминистратора вызывается
// из формы пользователя в обработчике перед записью,
// чтобы изменить текст вопроса пользователю,
// например, для подсистемы УправлениеДоступом.
//  Вызов происходит, если установлен ЗапретРедактированияРолей
// и количество пользователей информационной базы равно нулю.
// 
Процедура ТекстВопросаПередЗаписьюПервогоАдминистратора(ТекстВопроса) Экспорт
	
	// УправлениеДоступом
	ТекстВопроса = НСтр("ru = 'Первый пользователь информационной базы должен иметь полные права.
	                          |Пользователь будет добавлен в группу доступа Администраторы. Продолжить?'")
	// Конец УправлениеДоступом
	
КонецПроцедуры

// Обработчик события ПриЗаписиПервогоАдминистратора вызывается
// из формы пользователя в обработчике ПриЗаписиНаСервере,
// из функции Пользователи.ОшибкаАвторизации() при авторизации администратора,
// когда нет ни одного администратора зарегистрированного в справочнике Пользователи
//  Это нужно, например, для подсистемы УправлениеДоступом,
// чтобы добавить первого администратора в группу доступа Администраторы
// 
// Параметры:
//  Пользователь - СправочникСсылка.Пользователи (изменение объекта запрещено)
//
Процедура ПриЗаписиПервогоАдминистратора(Пользователь) Экспорт
	
	Возврат;
	
КонецПроцедуры

// Обработчик события ПослеЗаписиАдминистратораПриАвторизации вызывается
// из функции Пользователи.ОшибкаАвторизации() при авторизации администратора,
// когда администратор не зарегистрированн в справочнике Пользователи
//  Обработчик нужен, например, для подсистемы УправлениеДоступом,
// чтобы сообщить, что первый администратор добавлен в группу доступа Администраторы
// 
// Параметры:
//  Комментарий  - Строка - начальное значение задано, можно переустановить,
//                 комментарий записывается в журнал регистрации.
//
Процедура ПослеЗаписиАдминистратораПриАвторизации(Комментарий) Экспорт
	
	// УправлениеДоступом
	Комментарий = НСтр("ru = 'Обнаружено, что пользователь информационной базы
	                         |с ролью ""Полные права"" был создан в Конфигураторе:
	                         |
	                         |- пользователь не найден в справочнике Пользователи,
	                         |- пользователь зарегистрирован в справочнике Пользователи,
	                         |- пользователь добавлен в группу доступа Администраторы.
	                         |
	                         |Пользователей информационной базы следует создавать в режиме 1С:Предприятия.'");
	// Конец УправлениеДоступом
	
КонецПроцедуры

#КонецОбласти
