<?xml version="1.0" encoding="UTF-8"?>
<ФайлОбмена ВерсияФормата="2.0" ДатаВыгрузки="2017-03-17T14:11:04" НачалоПериодаВыгрузки="0001-01-01T00:00:00" ОкончаниеПериодаВыгрузки="0001-01-01T00:00:00" ИмяКонфигурацииИсточника="БИТУправлениеМедицинскимЦентром" ИмяКонфигурацииПриемника="БИТУправлениеМедицинскимЦентром" ИдПравилКонвертации="e39c5eab-9ab9-477c-929b-78800a32a5f3" Комментарий="">
<ПравилаОбмена>
	<ВерсияФормата>2.01</ВерсияФормата>
	<Ид>e39c5eab-9ab9-477c-929b-78800a32a5f3</Ид>
	<Наименование>БИТУправлениеМедицинскимЦентром --&gt; БИТУправлениеМедицинскимЦентром</Наименование>
	<ДатаВремяСоздания>2014-02-17T14:07:00</ДатаВремяСоздания>
	<Источник>БИТУправлениеМедицинскимЦентром</Источник>
	<Приемник>БИТУправлениеМедицинскимЦентром</Приемник>
	<Параметры/>
	<Обработки/>
	<ПравилаКонвертацииОбъектов>
		<Правило>
			<Код>ВычисляемыеЗначенияПараметров</Код>
			<СинхронизироватьПоИдентификатору>true</СинхронизироватьПоИдентификатору>
			<ПродолжитьПоискПоПолямПоискаЕслиПоИдентификаторуНеНашли>true</ПродолжитьПоискПоПолямПоискаЕслиПоИдентификаторуНеНашли>
			<Источник>СправочникСсылка.ВычисляемыеЗначенияПараметров</Источник>
			<Приемник>СправочникСсылка.ВычисляемыеЗначенияПараметров</Приемник>
		</Правило>
	</ПравилаКонвертацииОбъектов>
	<ПравилаОчисткиДанных/>
	<Алгоритмы/>
	<Запросы/>
</ПравилаОбмена>
<Объект Нпп="1" Тип="СправочникСсылка.ВычисляемыеЗначенияПараметров" ИмяПравила="ВычисляемыеЗначенияПараметров"><Ссылка Нпп="1">
	<Свойство Имя="{УникальныйИдентификатор}" Тип="Строка">
		<Значение>5cb664c5-0a38-11e7-828e-40167e631f2e</Значение>
	</Свойство>
	<Свойство Имя="Наименование" Тип="Строка">
		<Значение>Блок HTML: План лечения: без медикаментов</Значение>
	</Свойство>
</Ссылка>
	<Свойство Имя="АлгоритмВычисления" Тип="Строка">
		<Значение>// Заголовок над таблицей
ЗаголовокТаблицы = "Назначения";

// Текст над таблицей и шапка таблицы
ТекстШапки = ЗаголовокТаблицы + "
			|&lt;TABLE border=1 cellspacing='0'&gt;
			|&lt;TBODY&gt;
			|&lt;TR&gt;
			|&lt;TD style='WORD-WRAP: break-word'&gt;
			|&lt;P align=center&gt;Наименование услуги&lt;/P&gt;&lt;/TD&gt;
			|&lt;TD style='WORD-WRAP: break-word'&gt;
			|&lt;P align=center&gt;Дата&lt;/P&gt;&lt;/TD&gt;
			|&lt;TD style='WORD-WRAP: break-word'&gt;
			|&lt;P align=center&gt;Комментарий&lt;/P&gt;&lt;/TD&gt;&lt;/TR&gt;";

ТекстШапкиДобавлен = Ложь;

Текст = "";

// Строки таблицы
Для Каждого Строка Из ПланЛечения Цикл   

	Если Не (ТипЗнч(Строка.Номенклатура) = Тип("СправочникСсылка.Номенклатура")
				И РаботаСФормамиСервер.ЭтоМатериал(Строка.Номенклатура)
			 ИЛИ ТипЗнч(Строка.Номенклатура) = Тип("СправочникСсылка.СправочникМеждународныхНепатентованныхНаименований"))
	Тогда
		Текст = Текст + "&lt;TR&gt;";
		Если Строка.ВидЭлемента = Перечисления.ВидыНазначений Тогда
			Услуга = "Консультация врача специализации """ + Строка.Номенклатура.Наименование + """";
		ИначеЕсли ЗначениеЗаполнено(Строка.Номенклатура) Тогда
			Услуга = Строка.Номенклатура.Наименование;
		Иначе
			Услуга = "";
		КонецЕсли;
		
		Дата = ?(Строка.Дата = НачалоДня(Строка.Дата), Формат(Строка.Дата, "ДФ=dd.MM.yyyy"), Строка(Строка.Дата));
		Если Строка.Дата = Дата(1,1,1) Тогда
			Дата = "&amp;nbsp;";
		КонецЕсли;       
		Комментарий = ?(ПустаяСтрока(Строка.Комментарий), "&amp;nbsp;", Строка.Комментарий);
		
		ТекстСтроки = "";
		ТекстСтроки = ТекстСтроки + "&lt;TD style='WORD-WRAP: break-word'&gt;&lt;P&gt;" + Услуга + "&lt;/TD&gt;";
		ТекстСтроки = ТекстСтроки + "&lt;TD align=center&gt;" + Дата + "&lt;/TD&gt;";
		ТекстСтроки = ТекстСтроки + "&lt;TD style='WORD-WRAP: break-word' align=center&gt;" + Комментарий + "&lt;/TD&gt;&lt;/TR&gt;";

		Если Не ТекстШапкиДобавлен Тогда
			Текст = Текст + ТекстШапки;
			ТекстШапкиДобавлен = Истина;
		КонецЕсли;
		Текст = Текст + ТекстСтроки;
	КонецЕсли;
	
КонецЦикла;

Если ТекстШапкиДобавлен Тогда
	Текст = Текст + "&lt;/TBODY&gt;&lt;/TABLE&gt;";
КонецЕсли;

Результат = Текст;
</Значение>
	</Свойство>
</Объект>
<Объект Нпп="2" Тип="СправочникСсылка.ВычисляемыеЗначенияПараметров" ИмяПравила="ВычисляемыеЗначенияПараметров"><Ссылка Нпп="2">
	<Свойство Имя="{УникальныйИдентификатор}" Тип="Строка">
		<Значение>5cb664c3-0a38-11e7-828e-40167e631f2e</Значение>
	</Свойство>
	<Свойство Имя="Наименование" Тип="Строка">
		<Значение>Блок HTML: План лечения: медикаменты</Значение>
	</Свойство>
</Ссылка>
	<Свойство Имя="АлгоритмВычисления" Тип="Строка">
		<Значение>// Заголовок над таблицей
ЗаголовокТаблицы = "Медикаментозное лечение";

// Текст над таблицей и шапка таблицы
ТекстШапки = ЗаголовокТаблицы + "
		|&lt;TABLE border=1 cellspacing='0'&gt;
		|&lt;TBODY&gt;
		|&lt;TR&gt;
		|&lt;TD style='WORD-WRAP: break-word'&gt;
		|&lt;P align=center&gt;Медикаменты&lt;/P&gt;&lt;/TD&gt;
		|&lt;TD style='WORD-WRAP: break-word'&gt;
		|&lt;P align=center&gt;Период с&lt;/P&gt;&lt;/TD&gt;
		|&lt;TD style='WORD-WRAP: break-word'&gt;
		|&lt;P align=center&gt;До&lt;/P&gt;&lt;/TD&gt;
		|&lt;TD style='WORD-WRAP: break-word'&gt;
		|&lt;P align=center&gt;Разовая доза&lt;/P&gt;&lt;/TD&gt;
		|&lt;TD style='WORD-WRAP: break-word'&gt;
//		|&lt;P align=center&gt;Ед. изм.&lt;/P&gt;&lt;/TD&gt;
//		|&lt;TD style='WORD-WRAP: break-word'&gt;
		|&lt;P align=center&gt;Приемов в день&lt;/P&gt;&lt;/TD&gt;
		|&lt;TD style='WORD-WRAP: break-word'&gt;
		|&lt;P align=center&gt;Комментарий&lt;/P&gt;&lt;/TD&gt;&lt;/TR&gt;";

ТекстШапкиДобавлен = Ложь;

Текст = "";

Для Каждого Строка Из ПланЛечения Цикл   
	
	Если (ТипЗнч(Строка.Номенклатура) = Тип("СправочникСсылка.Номенклатура") 
		И РаботаСФормамиСервер.ЭтоМатериал(Строка.Номенклатура))
		ИЛИ ТипЗнч(Строка.Номенклатура) = Тип("СправочникСсылка.СправочникМеждународныхНепатентованныхНаименований")
	Тогда
		Текст = Текст + "&lt;TR&gt;";
		Медикамент = ?(ПустаяСтрока(Строка.Номенклатура.Наименование), "&amp;nbsp;", Строка.Номенклатура.Наименование);
		Дата = ?(Строка.Дата = НачалоДня(Строка.Дата), Формат(Строка.Дата, "ДФ=dd.MM.yyyy"), Строка(Строка.Дата));
		Если Строка.Дата = Дата(1,1,1) Тогда
			Дата = "&amp;nbsp;";
		КонецЕсли;
		ДатаОкончания = ?(Строка.ДатаОкончания = НачалоДня(Строка.ДатаОкончания), Формат(Строка.ДатаОкончания, "ДФ=dd.MM.yyyy"), Строка(Строка.ДатаОкончания));
		Если Строка.ДатаОкончания = Дата(1,1,1) Тогда
			ДатаОкончания = "&amp;nbsp;";
		КонецЕсли;
		Дозировка = ?(Строка.Дозировка = 0, "&amp;nbsp;", Строка(Строка.Дозировка));
		ЕдиницаИзмерения = Строка(Строка.ЕдиницаИзмерения);
		ПриемовВДень = ?(ПустаяСтрока(Строка.ПриемовВДень), "&amp;nbsp;", Строка.ПриемовВДень);
		Комментарий = ?(ПустаяСтрока(Строка.Комментарий), "&amp;nbsp;", Строка.Комментарий);
		
		ТекстСтроки = "";
		ТекстСтроки = ТекстСтроки + "&lt;TD style='WORD-WRAP: break-word'&gt;&lt;P&gt;" + Медикамент + "&lt;/TD&gt;";
		ТекстСтроки = ТекстСтроки + "&lt;TD align=center&gt;" + Дата + "&lt;/TD&gt;";
		ТекстСтроки = ТекстСтроки + "&lt;TD align=center&gt;" + ДатаОкончания + "&lt;/TD&gt;";
		ТекстСтроки = ТекстСтроки + "&lt;TD style='WORD-WRAP: break-word' align=center&gt;" + Дозировка + " " + ЕдиницаИзмерения + "&lt;/TD&gt;";
//		ТекстСтроки = ТекстСтроки + "&lt;TD style='WORD-WRAP: break-word' align=center&gt;" + ЕдиницаИзмерения + "&lt;/TD&gt;";
		ТекстСтроки = ТекстСтроки + "&lt;TD style='WORD-WRAP: break-word' align=center&gt;" + ПриемовВДень + "&lt;/TD&gt;";
		ТекстСтроки = ТекстСтроки + "&lt;TD style='WORD-WRAP: break-word' align=center&gt;" + Комментарий + "&lt;/TD&gt;&lt;/TR&gt;";
		
		Если Не ТекстШапкиДобавлен Тогда
			Текст = Текст + ТекстШапки;
			ТекстШапкиДобавлен = Истина;
		КонецЕсли;
		Текст = Текст + ТекстСтроки;
	КонецЕсли;
	
КонецЦикла;

Если ТекстШапкиДобавлен Тогда
	Текст = Текст + "&lt;/TBODY&gt;&lt;/TABLE&gt;";
КонецЕсли;

Результат = Текст;
</Значение>
	</Свойство>
</Объект>
</ФайлОбмена>
